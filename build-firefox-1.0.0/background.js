!function(){"use strict";var e={531:function(e,t,n){e.exports=n.p+"1bf7a6f4dd2582166c07.png"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");o.length&&(e=o[o.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),function(){const e={SEARCH:"search-only",WORKING:"working",READY:"reset",NOTIFICATION:"notification",GET_SELECTION:"get-selection",FIND_TERMS:"find-terms",VIEW_TERM:"view-term"},t="content",o="background",r="standard",s="advanced",a={16:"./icons/Imageshare-logo-no-text-white-16x16.jpg",48:"./icons/Imageshare-logo-no-text-white-48x48.jpg",128:"./icons/Imageshare-logo-no-text-white-128x128.jpg",1024:"./icons/Imageshare-logo-no-text-white-1024x1024.jpg"},c="https://imgsdev.wpengine.com/json-api/resources/";var i=browser;const d=async()=>new Promise((e=>{i.storage.local.get(["settings"],(t=>{if(void 0===t.settings)return e({subject:void 0,type:void 0,accommodation:void 0,source:void 0,setActiveTab:!0,createKeywordLinks:!1});e(t.settings)}))})),u=e=>i.tabs.query({active:!0,currentWindow:!0},(t=>e(t[0]))),m=e=>{new Promise((e=>{d().then((t=>e(!!t.setActiveTab)))})).then((t=>i.tabs.create({url:e,active:t})))},g=e=>fetch(e,{method:"GET",mode:"cors"}).then((e=>e.json())).then((e=>e.data));var h=n(531);const l=(e,t)=>i.notifications.create("",{title:e,message:t,iconUrl:h,type:"basic"}),p="Options",b=e=>()=>{i.runtime.lastError?console.error(`Error creating menu item ${e}: ${i.runtime.lastError}`):console.debug(`Menu item ${e} created successfully.`)};var f=()=>{console.debug("Setting up right-click context menu");const e="selection";i.contextMenus.create({title:"Imageshare standard search",contexts:[e],id:"imageshare-standard-search"},b("imageshare-standard-search")),i.contextMenus.create({title:"Imageshare advanced search",contexts:[e],id:"imageshare-advanced-search"},b("imageshare-advanced-search")),console.debug("Setting up bookmark menu item"),i.menus.create({id:p,type:"normal",title:"Options",contexts:["browser_action"]},(()=>{if(i.runtime.lastError)return console.debug(`Error creating bookmark menu item: ${i.runtime.lastError}`);console.debug("Bookmark menu item created successfully"),i.menus.onClicked.addListener(((e,t)=>{e.menuItemId===p&&(i.runtime.openOptionsPage?i.runtime.openOptionsPage():window.open(i.runtime.getURL("options.html")))}))}))},v=i.browserAction;const w=e=>void 0===e||"0"==e?"":encodeURIComponent(e),$=e=>e.length>10?e.substr(0,9)+"â€¦":e,I=e=>{return(t=e,g(`${c}filter/?query=${t}`)).then((t=>{v.setBadgeText({text:t.length.toString()});const n=$(e);return 0===t.length?(console.debug(`No results found for "${n}"`),l(`No results for "${n}"`,"Try another search term.")):1===t.length?(console.debug(`One result found for "${n}"`),m(t[0].permalink),l("One match found","It has been opened in a new tab.")):(console.debug(`${t.length} results found for "${n}"`),m("https://imageshare.benetech.org/?page=search&q="+e),void l(`${t.length} matches for "${n}"`,"They have been opened in a new tab."))})).catch((e=>console.error("Unable to fetch standard search query results from API",e)));var t},y=(e,t,n,o,r)=>{const s=w(t),a=w(n),i=w(o),d=w(r);return e=encodeURIComponent(e),((e,t,n,o,r)=>g(`${c}filter/?query=${e}&subject=${t}&type=${n}&acc=${o}&src=${r}`))(term,s,a,i,d).then((e=>{if(v.setBadgeText({text:e.length.toString()}),shortTerm=$(term),0===e.length)return console.debug(`No results found for "${shortTerm}"`),l(`No results for "${shortTerm}"`,"Try another term or adjust search criteria.");if(1===e.length){console.debug(`One result found for "${shortTerm}"`);const t=e[0].permalink;return m(t),l("One match found","It has been opened in a new tab.")}console.debug(`${e.length} results found for "${shortTerm}"`),m("https://imageshare.benetech.org/?page=search&q="+term+"&subject="+s+"&type="+a+"&acc="+i+"&src="+d),l(`${e.length} matches for "${shortTerm}"`,"They have been opened in a new tab.")})).catch((e=>console.error("Unable to fetch advanced search query results from API",e)))},T=e=>e.type===r?I(e.selection):e.type===s?d().then((t=>{var n;void 0===(n=t).subject&&void 0===n.type&&void 0===n.accommodation&&void 0===n.source?(console.debug("No pre-existing criteria, notifying user."),l("No advanced search criteria set.","Configure these criteria on the options page."),i.runtime.openOptionsPage?i.runtime.openOptionsPage():window.open(i.runtime.getURL("options.html"))):y(e.selection,t.subject,t.type,t.accommodation,t.source)})):void 0,x=()=>{u((n=>{i.tabs.sendMessage(n.id,{command:e.WORKING,target:t})}))},E=()=>{u((n=>{i.tabs.sendMessage(n.id,{command:e.READY,target:t})}))};((e,t)=>{window.addEventListener("load",(()=>{f(),i.contextMenus.onClicked.addListener(e),i.runtime.onMessage.addListener(t),console.debug("Background script loaded.")}))})(((t,n)=>{const o=t.selectionText,a=t.menuItemId,c={"imageshare-standard-search":r,"imageshare-advanced-search":s};console.debug(`Menu item ${a} clicked with selection "${o}"`),x(),T({command:e.BACKGROUND_SEARCH,type:c[a],selection:o}).then(E)}),((t,n,r)=>{var s;return console.debug("Background receiving message",t),t.target!==o&&r(),t.command===e.VIEW_TERM&&(m((s=t.term,"https://imageshare.benetech.org/?page=search&q="+encodeURIComponent(s))),r()),t.command&&t.command===e.NOTIFICATION&&(l(t.title,t.message),r()),t.command&&t.command===e.SEARCH&&(x(),T(t).then(E).then(r)),t.scheme&&"dark"===t.scheme&&(console.debug("Setting dark color scheme icons"),v.setIcon({path:a}),r()),!0}))}()}();