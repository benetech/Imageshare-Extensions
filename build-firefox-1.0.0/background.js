!function(){"use strict";var e={531:function(e,t,n){e.exports=n.p+"1bf7a6f4dd2582166c07.png"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");o.length&&(e=o[o.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),function(){const e={SEARCH:"search-only",WORKING:"working",READY:"reset",NOTIFICATION:"notification",GET_SELECTION:"get-selection",FIND_TERMS:"find-terms"},t="content",o="background",r="standard",s="advanced",a={16:"./icons/Imageshare-logo-no-text-white-16x16.jpg",48:"./icons/Imageshare-logo-no-text-white-48x48.jpg",128:"./icons/Imageshare-logo-no-text-white-128x128.jpg",1024:"./icons/Imageshare-logo-no-text-white-1024x1024.jpg"},c="https://imgsdev.wpengine.com/json-api/resources/";var i=browser;const d=async()=>new Promise((e=>{i.storage.local.get(["settings"],(t=>{if(void 0===t.settings)return e({subject:void 0,type:void 0,accommodation:void 0,source:void 0,setActiveTab:!1,notSet:!0});e(t.settings)}))})),u=e=>i.tabs.query({active:!0,currentWindow:!0},(t=>e(t[0]))),g=e=>fetch(e,{method:"GET",mode:"cors"}).then((e=>e.json())).then((e=>e.data));var l=n(531);const m=(e,t)=>i.notifications.create("",{title:e,message:t,iconUrl:l,type:"basic"}),h="Options",p=e=>()=>{i.runtime.lastError?console.error(`Error creating menu item ${e}: ${i.runtime.lastError}`):console.debug(`Menu item ${e} created successfully.`)};var b=()=>{console.debug("Setting up right-click context menu");const e="selection";i.contextMenus.create({title:"Imageshare standard search",contexts:[e],id:"imageshare-standard-search"},p("imageshare-standard-search")),i.contextMenus.create({title:"Imageshare advanced search",contexts:[e],id:"imageshare-advanced-search"},p("imageshare-advanced-search")),console.debug("Setting up bookmark menu item"),i.menus.create({id:h,type:"normal",title:"Options",contexts:["browser_action"]},(()=>{if(i.runtime.lastError)return console.debug(`Error creating bookmark menu item: ${i.runtime.lastError}`);console.debug("Bookmark menu item created successfully"),i.menus.onClicked.addListener(((e,t)=>{e.menuItemId===h&&(i.runtime.openOptionsPage?i.runtime.openOptionsPage():window.open(i.runtime.getURL("options.html")))}))}))},f=i.browserAction;const v=e=>void 0===e||"0"==e?"":encodeURIComponent(e),w=e=>new Promise((e=>{d().then((t=>e(!!t.setActiveTab)))})).then((t=>i.tabs.create({url:e,active:t}))),$=e=>(e=>g(`${c}filter/?query=${e}`))(e).then((t=>(f.setBadgeText({text:t.length.toString()}),0===t.length?(console.debug(`No results found for "${e}"`),m("No results",`"${e}" yielded no Imageshare entries.`)):1===t.length?(console.debug(`One result found for ${e}`),w(t[0].permalink),m("One match found","It has been opened in a new tab.")):(console.debug(`${t.length} results found for "${e}"`),w("https://imageshare.benetech.org/?page=search&q="+e),void m(`${t.length} matches for ${e}`,"These matches have been opened in a new tab."))))).catch((e=>console.error("Unable to fetch standard search query results from API",e))),I=(e,t,n,o,r)=>{const s=v(t),a=v(n),i=v(o),d=v(r);return((e,t,n,o,r)=>g(`${c}filter/?query=${e}&subject=${t}&type=${n}&acc=${o}&src=${r}`))(e=encodeURIComponent(e),s,a,i,d).then((t=>{if(f.setBadgeText({text:t.length.toString()}),0===t.length)return console.debug(`No results found for "${e}"`),m(`No results found for ${e}`,"Try another selection or adjust your search criteria.");if(1===t.length){console.debug(`One result found for ${e}`);const n=t[0].permalink;return w(n),m("One match found","It has been opened in a new tab.")}console.debug(`${t.length} results found for "${e}"`),w("https://imageshare.benetech.org/?page=search&q="+e+"&subject="+s+"&type="+a+"&acc="+i+"&src="+d),m(`${t.length} matches for ${e}`,"These matches have been opened in a new tab.")})).catch((e=>console.error("Unable to fetch advanced search query results from API",e)))},x=e=>e.type===r?$(e.selection):e.type===s?d().then((t=>{(e=>e.notSet)(t)?(console.debug("No pre-existing criteria, notifying user."),m("No advanced search criteria set.","Configure advanced search criteria on options page."),i.runtime.openOptionsPage?i.runtime.openOptionsPage():window.open(i.runtime.getURL("options.html"))):I(e.selection,t.subject,t.type,t.accommodation,t.source)})):void 0,y=()=>{u((n=>{i.tabs.sendMessage(n.id,{command:e.WORKING,target:t})}))},E=()=>{u((n=>{i.tabs.sendMessage(n.id,{command:e.READY,target:t})}))};((e,t)=>{window.addEventListener("load",(()=>{b(),i.contextMenus.onClicked.addListener(e),i.runtime.onMessage.addListener(t),console.debug("Background script loaded.")}))})(((t,n)=>{const o=t.selectionText,a=t.menuItemId,c={"imageshare-standard-search":r,"imageshare-advanced-search":s};console.debug(`Menu item ${a} clicked with selection "${o}"`),y(),x({command:e.BACKGROUND_SEARCH,type:c[a],selection:o}).then(E)}),((t,n,r)=>(console.debug("Background receiving message",t),t.target!==o&&r(),t.command&&t.command===e.NOTIFICATION&&m(t.title,t.message),t.command&&t.command===e.SEARCH&&(y(),x(t).then(E)),t.scheme&&"dark"===t.scheme&&(console.debug("Setting dark color scheme icons"),f.setIcon({path:a})),r(),!0)))}()}();