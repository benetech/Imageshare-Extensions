!function(){"use strict";var e={531:function(e,t,n){e.exports=n.p+"1bf7a6f4dd2582166c07.png"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");o.length&&(e=o[o.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),function(){const e={SEARCH:"search-only",WORKING:"working",READY:"reset",NOTIFICATION:"notification",GET_SELECTION:"get-selection"},t="standard",o="advanced",r={16:"./icons/Imageshare-logo-no-text-white.png",48:"./icons/Imageshare-logo-no-text-white.png",128:"./icons/Imageshare-logo-no-text-white.png",512:"./icons/Imageshare-logo-no-text-white.png",1024:"./icons/Imageshare-logo-no-text-white.png"},s="https://imgsdev.wpengine.com/json-api/resources/";var a=browser;const c=e=>fetch(e,{method:"GET"}).then((e=>e.json())).then((e=>e.data));var i=n(531);const d=(e,t)=>a.notifications.create("",{title:e,message:t,iconUrl:i,type:"basic"}),u="Options",g=e=>()=>{a.runtime.lastError?console.error(`Error creating menu item ${e}: ${a.runtime.lastError}`):console.debug(`Menu item ${e} created successfully.`)};const l=e=>new Promise((e=>{a.storage.local.get(["active"],(t=>e(!!t.active)))})).then((t=>a.tabs.create({url:e,active:t}))),h=e=>{var n;e.type!==t?e.type===o&&new Promise((e=>{a.storage.local.get(["settings"],(t=>e(t.settings)))})).then((t=>{void 0===t?(console.debug("No pre-existing criteria, notifying user."),d("No advanced search criteria set.","Configure advanced search criteria on options page."),a.runtime.openOptionsPage?a.runtime.openOptionsPage():window.open(a.runtime.getURL("options.html"))):((e,t,n,o,r)=>{((e,t,n,o,r)=>c(`${s}filter/?query=${e}&subject=${t}&type=${n}&acc=${o}&src=${r}`))(e,t,n,o,r).then((s=>{if(0===s.length)return console.debug(`No results found for "${e}"`),d(`No results found for ${e}`,"Try another selection or adjust your search criteria.");if(1===s.length){console.debug(`One result found for ${e}`);const t=s[0].permalink;return l(t),d("One match found","It has been opened in a new tab.")}console.debug(`${s.length} found for ${e}`),l("https://imageshare.benetech.org/?page=search&q="+e+"&subject="+t+"&type="+n+"&acc="+o+"&src="+r),d(`${s.length} matches for ${e}`,"These matches have been opened in a new tab.")})).catch((e=>console.error("Unable to fetch advanced search query results from API",e)))})(e.selection,t.subject,t.type,t.accommodation,t.source)})):(e=>c(`${s}filter/?query=${e}`))(n=e.selection).then((e=>0===e.length?(console.debug(`No results found for "${n}"`),d("No results",`"${n}" yielded no Imageshare entries.`)):1===e.length?(console.debug(`One result found for ${n}`),l(e[0].permalink),d("One match found","It has been opened in a new tab.")):(console.debug(`${e.length} found for ${n}`),l("https://imageshare.benetech.org/?page=search&q="+n),void d(`${e.length} matches for ${n}`,"These matches have been opened in a new tab.")))).catch((e=>console.error("Unable to fetch standard search query results from API",e)))};var m,p;m=(n,r)=>{const s=n.selectionText,a=n.menuItemId,c={"imageshare-standard-search":t,"imageshare-advanced-search":o};console.debug(`Menu item ${a} clicked with selection "${s}"`),h({command:e.BACKGROUND_SEARCH,type:c[a],selection:s})},p=(t,n,o)=>{console.debug("Background receiving message",t),"background"!==t.target&&o(),t.command&&t.command===e.NOTIFICATION&&d(t.title,t.message),t.command&&t.command===e.SEARCH&&h(t),t.scheme&&"dark"===t.scheme&&(console.debug("Setting dark color scheme icons"),a.browserAction.setIcon({path:r})),o()},window.addEventListener("load",(()=>{(()=>{console.debug("Setting up right-click context menu");const e="selection";a.contextMenus.create({title:"Imageshare standard search",contexts:[e],id:"imageshare-standard-search"},g("imageshare-standard-search")),a.contextMenus.create({title:"Imageshare advanced search",contexts:[e],id:"imageshare-advanced-search"},g("imageshare-advanced-search")),console.debug("Setting up bookmark menu item"),a.menus.create({id:u,type:"normal",title:"Options",contexts:["browser_action"]},(()=>{if(a.runtime.lastError)return console.debug(`Error creating bookmark menu item: ${a.runtime.lastError}`);console.debug("Bookmark menu item created successfully"),a.menus.onClicked.addListener(((e,t)=>{e.menuItemId===u&&(a.runtime.openOptionsPage?a.runtime.openOptionsPage():window.open(a.runtime.getURL("options.html")))}))}))})(),a.contextMenus.onClicked.addListener(m),a.runtime.onMessage.addListener(p),console.debug("Background script loaded.")}))}()}();